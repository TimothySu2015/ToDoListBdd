#!/bin/bash
# scripts/log-change.sh
# è®Šæ›´è¨˜éŒ„å·¥å…·

echo "======================================"
echo "    è®Šæ›´è¨˜éŒ„å·¥å…·"
echo "======================================"
echo ""

# å»ºç«‹è®Šæ›´è¨˜éŒ„ç›®éŒ„
mkdir -p docs/change-logs

# ç”Ÿæˆæª”æ¡ˆåç¨±
DATE=$(date +%Y-%m-%d)
TIME=$(date +%H%M)
LOG_FILE="docs/change-logs/change-$DATE-$TIME.md"

echo "ğŸ“ å»ºç«‹è®Šæ›´è¨˜éŒ„æª”æ¡ˆ..."
echo "ğŸ“ æª”æ¡ˆä½ç½®: $LOG_FILE"
echo ""

# å»ºç«‹è®Šæ›´è¨˜éŒ„ç¯„æœ¬
cat > "$LOG_FILE" << EOF
# è®Šæ›´è¨˜éŒ„ - $DATE

## åŸºæœ¬è³‡è¨Š
- **è®Šæ›´æ—¥æœŸ**: $(date +%Y-%m-%d)
- **è¨˜éŒ„æ™‚é–“**: $(date +%H:%M:%S)
- **è¨˜éŒ„äºº**: [è«‹å¡«å…¥å§“å]

## è®Šæ›´å…§å®¹
[è«‹è©³ç´°æè¿°åŸå§‹éœ€æ±‚è®Šæ›´å…§å®¹]

### ç¯„ä¾‹ï¼š
ç”¨æˆ¶å¸Œæœ›å¯ä»¥ç‚ºæ¯å€‹ä»»å‹™è¨­å®šå„ªå…ˆé †åºï¼ˆé«˜ã€ä¸­ã€ä½ï¼‰ï¼Œä¸¦ä¸”å¯ä»¥æŒ‰å„ªå…ˆé †åºæ’åºä»»å‹™åˆ—è¡¨ã€‚

## æ–°å¢çš„ BDD å ´æ™¯
- [ ] Scenario X: [å ´æ™¯åç¨±] - [ç°¡çŸ­æè¿°]
- [ ] Scenario Y: [å ´æ™¯åç¨±] - [ç°¡çŸ­æè¿°]

### å ´æ™¯ä½ç½®
- æª”æ¡ˆ: docs/bdd-specifications.md
- ä½ç½®: [è¡Œè™Ÿæˆ–ç« ç¯€]

## æ–°å¢/èª¿æ•´çš„ Story
- [ ] Story X.X: [Story åç¨±] - [ç‹€æ…‹: è¨ˆåŠƒä¸­/é€²è¡Œä¸­/å·²å®Œæˆ]
- [ ] Story Y.Y: [Story åç¨±] - [ç‹€æ…‹: è¨ˆåŠƒä¸­/é€²è¡Œä¸­/å·²å®Œæˆ]

### Story è©³æƒ…
| Story | æè¿° | è¤‡é›œåº¦ | é ä¼°æ™‚é–“ | å¯¦éš›æ™‚é–“ | ç‹€æ…‹ |
|-------|------|--------|----------|----------|------|
| Story X.X | [Story æè¿°] | [ç°¡å–®/ä¸­ç­‰/è¤‡é›œ] | [X å¤©] | [Y å¤©] | [é€²è¡Œä¸­] |

## æŠ€è¡“å¯¦ä½œå…§å®¹

### API è®Šæ›´
- [ ] æ–°å¢ç«¯é»: [ç«¯é»è·¯å¾‘] - [æè¿°]
- [ ] ä¿®æ”¹ç«¯é»: [ç«¯é»è·¯å¾‘] - [è®Šæ›´å…§å®¹]

### è³‡æ–™æ¨¡å‹è®Šæ›´
- [ ] æ–°å¢å¯¦é«”: [å¯¦é«”åç¨±] - [æè¿°]
- [ ] ä¿®æ”¹å¯¦é«”: [å¯¦é«”åç¨±] - [è®Šæ›´å…§å®¹]
- [ ] è³‡æ–™åº«é·ç§»: [migration æª”æ¡ˆ] - [æ˜¯å¦å®Œæˆ]

### å‰ç«¯è®Šæ›´
- [ ] æ–°å¢å…ƒä»¶: [å…ƒä»¶åç¨±] - [æè¿°]
- [ ] ä¿®æ”¹å…ƒä»¶: [å…ƒä»¶åç¨±] - [è®Šæ›´å…§å®¹]
- [ ] ç‹€æ…‹ç®¡ç†: [Service/Store è®Šæ›´] - [æè¿°]

## æ¸¬è©¦é©—è­‰

### BDD æ¸¬è©¦
- [ ] å‰ç«¯ BDD æ¸¬è©¦: [æ¸¬è©¦æª”æ¡ˆ] - [é€šé/å¤±æ•—]
- [ ] å¾Œç«¯ BDD æ¸¬è©¦: [æ¸¬è©¦æª”æ¡ˆ] - [é€šé/å¤±æ•—]
- [ ] E2E BDD æ¸¬è©¦: [æ¸¬è©¦æª”æ¡ˆ] - [é€šé/å¤±æ•—]

### åŠŸèƒ½é©—è­‰
- [ ] æ–°åŠŸèƒ½é‹ä½œæ­£å¸¸
- [ ] ç¾æœ‰åŠŸèƒ½æœªå—å½±éŸ¿
- [ ] ç”¨æˆ¶ä»‹é¢ç¬¦åˆè¨­è¨ˆ
- [ ] æ•ˆèƒ½ç¬¦åˆè¦æ±‚

### ç”¨æˆ¶é©—æ”¶
- [ ] åŠŸèƒ½æ¼”ç¤ºå®Œæˆ
- [ ] ç”¨æˆ¶å›é¥‹æ”¶é›†
- [ ] å•é¡Œä¿®æ­£å®Œæˆ
- [ ] æœ€çµ‚é©—æ”¶é€šé

## å®Œæˆç‹€æ…‹
- **é–‹å§‹æ—¥æœŸ**: [YYYY-MM-DD]
- **å®Œæˆæ—¥æœŸ**: [YYYY-MM-DD]
- **ç¸½è€—æ™‚**: [X å¤©]
- **æ•´é«”ç‹€æ…‹**: [è¨ˆåŠƒä¸­/é€²è¡Œä¸­/å·²å®Œæˆ/æš«åœ]

## ç¶“é©—å­¸ç¿’

### é †åˆ©çš„åœ°æ–¹
- [è¨˜éŒ„é€²è¡Œé †åˆ©çš„éƒ¨åˆ†]
- [æœ‰æ•ˆçš„å·¥å…·æˆ–æ–¹æ³•]

### é‡åˆ°çš„æŒ‘æˆ°
- [è¨˜éŒ„é‡åˆ°çš„å›°é›£]
- [è§£æ±ºæ–¹æ¡ˆ]

### æ”¹é€²å»ºè­°
- [æµç¨‹æ”¹é€²å»ºè­°]
- [å·¥å…·æ”¹é€²å»ºè­°]

## ç›¸é—œè³‡æ–™
- **ç›¸é—œ Issue**: [GitHub Issue é€£çµ]
- **ç›¸é—œ PR**: [Pull Request é€£çµ]
- **ç›¸é—œæ–‡ä»¶**: [å…¶ä»–ç›¸é—œæ–‡ä»¶é€£çµ]
- **BDD å ´æ™¯ä½ç½®**: docs/bdd-specifications.md
- **Story æµç¨‹åƒè€ƒ**: docs/story-driven-development-workflow.md

---
*æ­¤è¨˜éŒ„ç”± log-change.sh å·¥å…·è‡ªå‹•ç”Ÿæˆæ–¼ $(date)*
EOF

echo "âœ… è®Šæ›´è¨˜éŒ„æª”æ¡ˆå·²å»ºç«‹"
echo ""
echo "ğŸ“‹ è«‹å®Œæˆä»¥ä¸‹æ­¥é©Ÿï¼š"
echo "   1. ç·¨è¼¯æª”æ¡ˆ: $LOG_FILE"
echo "   2. å¡«å…¥å…·é«”çš„è®Šæ›´å…§å®¹"
echo "   3. æ›´æ–°é€²åº¦ç‹€æ…‹"
echo "   4. å®Œæˆå¾Œä¿å­˜æª”æ¡ˆ"
echo ""

# è©¢å•æ˜¯å¦ç«‹å³é–‹å•Ÿæª”æ¡ˆç·¨è¼¯
read -p "æ˜¯å¦è¦ç«‹å³é–‹å•Ÿæª”æ¡ˆé€²è¡Œç·¨è¼¯ï¼Ÿ(y/N): " OPEN_FILE

if [[ $OPEN_FILE =~ ^[Yy]$ ]]; then
    if command -v code >/dev/null 2>&1; then
        echo "ğŸš€ ä½¿ç”¨ VS Code é–‹å•Ÿæª”æ¡ˆ..."
        code "$LOG_FILE"
    elif command -v notepad >/dev/null 2>&1; then
        echo "ğŸš€ ä½¿ç”¨è¨˜äº‹æœ¬é–‹å•Ÿæª”æ¡ˆ..."
        notepad "$LOG_FILE"
    else
        echo "ğŸ“ è«‹æ‰‹å‹•é–‹å•Ÿæª”æ¡ˆ: $LOG_FILE"
    fi
fi

echo ""
echo "ğŸ“Š è®Šæ›´è¨˜éŒ„çµ±è¨ˆï¼š"

# çµ±è¨ˆè®Šæ›´è¨˜éŒ„æ•¸é‡
TOTAL_LOGS=$(find docs/change-logs -name "change-*.md" 2>/dev/null | wc -l)
echo "   ğŸ“ ç¸½è®Šæ›´è¨˜éŒ„æ•¸: $TOTAL_LOGS"

# é¡¯ç¤ºæœ€è¿‘çš„è®Šæ›´è¨˜éŒ„
if [ $TOTAL_LOGS -gt 1 ]; then
    echo "   ğŸ“… æœ€è¿‘çš„è®Šæ›´è¨˜éŒ„:"
    find docs/change-logs -name "change-*.md" -type f -exec basename {} \; | sort -r | head -3 | while read -r file; do
        echo "      â€¢ $file"
    done
fi

echo ""
echo "ğŸ”— ç›¸é—œå‘½ä»¤ï¼š"
echo "   æŸ¥çœ‹æ‰€æœ‰è®Šæ›´è¨˜éŒ„: ls docs/change-logs/"
echo "   æŸ¥çœ‹ BDD è¦æ ¼: code docs/bdd-specifications.md"
echo "   é–‹å§‹éœ€æ±‚åˆ†æ: ./scripts/requirement-to-bdd.sh"
echo "   å½±éŸ¿åˆ†æ: ./scripts/analyze-bdd-impact.sh \"é—œéµå­—\""

echo ""
echo "======================================"
echo "    è®Šæ›´è¨˜éŒ„å»ºç«‹å®Œæˆ"
echo "======================================"