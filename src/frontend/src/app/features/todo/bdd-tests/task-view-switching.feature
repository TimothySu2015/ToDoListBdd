Feature: 任務檢視切換
  As a 生產力使用者
  I want to 切換不同的任務檢視
  So that 我可以專注於相關的任務

  Background:
    Given 我在應用程式的主頁面
    And 系統中有以下任務：
      | 任務描述        | 狀態  |
      | 開發新功能      | 待辦  |
      | 測試功能        | 待辦  |
      | 部署到生產環境   | 已完成 |
      | 撰寫文件        | 已完成 |

  Scenario: 預設檢視為待辦任務
    Then 檢視切換器應該顯示
    And "待辦" 按鈕應該是活躍狀態
    And 任務計數應該顯示 "待辦 (2)"
    And 我應該看到 2 個任務
    And 我應該看到任務 "開發新功能"
    And 我應該看到任務 "測試功能"

  Scenario: 切換到已完成任務檢視
    When 我點擊 "已完成" 檢視按鈕
    Then "已完成" 按鈕應該是活躍狀態
    And 任務計數應該顯示 "已完成 (2)"
    And 我應該看到 2 個任務
    And 我應該看到任務 "部署到生產環境"
    And 我應該看到任務 "撰寫文件"
    And 我不應該看到任務 "開發新功能"

  Scenario: 切換到全部任務檢視
    When 我點擊 "全部" 檢視按鈕
    Then "全部" 按鈕應該是活躍狀態
    And 任務計數應該顯示 "全部 (4)"
    And 我應該看到 4 個任務
    And 我應該看到任務 "開發新功能"
    And 我應該看到任務 "測試功能"
    And 我應該看到任務 "部署到生產環境"
    And 我應該看到任務 "撰寫文件"

  Scenario: 檢視狀態持久化
    When 我點擊 "已完成" 檢視按鈕
    And 我重新載入頁面
    Then "已完成" 按鈕應該是活躍狀態
    And 只顯示已完成的任務

  Scenario: 載入狀態顯示
    When 我點擊 "已完成" 檢視按鈕
    Then 應該顯示載入狀態
    And 按鈕應該被禁用直到載入完成

  Scenario: 檢視按鈕計數即時更新
    Given 我在 "待辦" 檢視
    When 我標記任務 "開發新功能" 為已完成
    Then 任務計數應該更新為 "待辦 (1)"
    And 任務 "開發新功能" 應該從待辦檢視中移除

  Scenario: 空狀態提示顯示
    Given 系統中沒有已完成的任務
    When 我點擊 "已完成" 檢視按鈕
    Then 應該顯示空狀態提示 "還沒有已完成的任務"
    And 任務計數應該顯示 "已完成 (0)"

  Scenario: 檢視切換動畫效果
    When 我點擊 "已完成" 檢視按鈕
    Then 應該有流暢的切換動畫
    And 任務列表應該有漸變效果

  Scenario: 無障礙支援
    Then 每個檢視按鈕應該有適當的 aria-label
    And 按鈕狀態應該用 aria-pressed 表示
    And 應該支援鍵盤導航

  Scenario: 新增任務後自動檢視切換
    Given 我在 "已完成" 檢視
    When 我新增任務 "新的待辦任務"
    Then 應該自動切換到 "待辦" 檢視
    And 我應該看到新增的任務