<div class="task-list-container">
  <!-- ä»»å‹™è¨ˆæ•¸å™¨ -->
  <div class="task-counter" data-testid="task-counter">
    <h2>å¾…è¾¦ä»»å‹™</h2>
    <div class="task-counts">
      <span class="pending-count">
        {{ taskService.pendingTaskCount() }} å€‹å¾…è¾¦ä»»å‹™
      </span>
      <span class="separator">Â·</span>
      <span class="completed-count">
        {{ taskService.completedTaskCount() }} å€‹å·²å®Œæˆ
      </span>
    </div>
  </div>

  <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ -->
  <div 
    *ngIf="taskService.loading()" 
    class="loading-container"
    data-testid="loading-container"
  >
    <div class="loading-spinner-large"></div>
    <p>è¼‰å…¥ä»»å‹™ä¸­...</p>
  </div>

  <!-- éŒ¯èª¤è¨Šæ¯ -->
  <div 
    *ngIf="hasError()" 
    class="error-container"
    data-testid="error-container"
  >
    <div class="error-icon">âš ï¸</div>
    <div class="error-content">
      <h3>è¼‰å…¥å¤±æ•—</h3>
      <p>{{ taskService.error() }}</p>
      <button 
        type="button" 
        class="retry-button"
        (click)="retry()"
        data-testid="retry-button"
      >
        é‡æ–°è¼‰å…¥
      </button>
    </div>
  </div>

  <!-- ç©ºç‹€æ…‹ -->
  <div 
    *ngIf="isEmpty() && !taskService.loading() && !hasError()" 
    class="empty-state"
    data-testid="empty-state"
  >
    <div class="empty-icon">ğŸ“</div>
    <h3>é‚„æ²’æœ‰ä»»å‹™</h3>
    <p>é–‹å§‹æ–°å¢æ‚¨çš„ç¬¬ä¸€å€‹å¾…è¾¦ä»»å‹™å§ï¼</p>
  </div>

  <!-- ä»»å‹™åˆ—è¡¨ -->
  <div 
    *ngIf="!isEmpty() && !hasError()" 
    class="task-list"
    data-testid="task-list"
  >
    <div 
      *ngFor="let task of taskService.tasks(); trackBy: trackByTaskId; index as i" 
      class="task-item"
      [class.completed]="task.isCompleted"
      [class.completing]="isTaskAnimating(task.id, 'completing')"
      [class.uncompleting]="isTaskAnimating(task.id, 'uncompleting')"
      [attr.data-testid]="'task-item-' + task.id"
      [attr.data-index]="i"
      tabindex="0"
      (keydown)="onTaskItemKeydown($event, task)"
    >
      <div class="task-content">
        <div class="task-checkbox"
             [class.checked]="task.isCompleted"
             [class.completing]="isTaskAnimating(task.id, 'completing')"
             [class.uncompleting]="isTaskAnimating(task.id, 'uncompleting')"
             (click)="onTaskStatusToggle(task)"
             data-testid="task-checkbox"
             role="checkbox"
             [attr.aria-checked]="task.isCompleted"
             tabindex="0"
             (keydown)="onCheckboxKeydown($event, task)">
          <div class="checkbox-indicator">
            <span *ngIf="task.isCompleted" class="checkmark">âœ“</span>
          </div>
        </div>
        
        <div class="task-details">
          <p class="task-description task-text" 
             [class.completed-text]="task.isCompleted"
             [title]="task.description">
            {{ task.description }}
          </p>
          <div class="task-meta">
            <span class="task-time">{{ formatDate(task.createdAt) }}</span>
            <span class="task-id">ID: {{ task.id }}</span>
          </div>
        </div>
      </div>

      <!-- æ–°ä»»å‹™æ¨™è¨˜ (å‰3å€‹ä»»å‹™é¡¯ç¤º) -->
      <div 
        *ngIf="i < 3" 
        class="new-task-badge"
        data-testid="new-task-badge"
      >
        æ–°å¢
      </div>
    </div>
  </div>

  <!-- åˆ—è¡¨åº•éƒ¨è³‡è¨Š -->
  <div 
    *ngIf="!isEmpty() && !hasError()" 
    class="list-footer"
    data-testid="list-footer"
  >
    <p class="list-info">
      å…± {{ taskService.taskCount() }} é …ä»»å‹™
      <span *ngIf="taskService.incompleteTasks().length > 0">
        Â· {{ taskService.incompleteTasks().length }} é …å¾…å®Œæˆ
      </span>
    </p>
    
    <button 
      type="button" 
      class="refresh-button"
      (click)="reloadTasks()"
      [disabled]="taskService.loading()"
      data-testid="refresh-button"
    >
      ğŸ”„ é‡æ–°æ•´ç†
    </button>
  </div>
</div>