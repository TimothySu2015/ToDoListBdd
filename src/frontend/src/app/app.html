<div class="container">
  <header class="app-header">
    <div class="header-content">
      <div class="title-section">
        <h1>{{ title() }}</h1>
        <p class="app-subtitle">高效的待辦事項管理工具</p>
      </div>
      <div class="header-actions">
        <button 
          class="help-button"
          (click)="showKeyboardHelp()"
          title="快捷鍵說明 (Ctrl+? 或 F1)"
          [attr.data-testid]="'keyboard-help-button'"
          aria-label="顯示鍵盤快捷鍵說明"
        >
          <span class="help-icon">❓</span>
          <span class="help-text">快捷鍵</span>
        </button>
      </div>
    </div>
  </header>
  
  <!-- API 連線狀態區域 -->
  <div class="api-status" [class.collapsed]="apiStatus() === '連線正常'">
    <div class="status-header" (click)="toggleApiStatus()">
      <h3>API 連線狀態</h3>
      <span [class]="apiStatus() === '連線正常' ? 'status-success' : 'status-error'">
        {{ apiStatus() }}
      </span>
    </div>
    
    @if (!isApiStatusCollapsed() || apiStatus() !== '連線正常') {
      <div class="status-details">
        @if (apiResponse()) {
          <div class="api-response">
            <pre>{{ apiResponse() | json }}</pre>
          </div>
        }
        <button (click)="checkApiHealth()" class="btn-refresh">重新檢查連線</button>
      </div>
    }
  </div>

  <!-- 主要待辦清單功能區域 -->
  @if (apiStatus() === '連線正常') {
    <main class="todo-main">
      <!-- 新增任務區域 -->
      <section class="task-input-section">
        <app-task-input></app-task-input>
      </section>
      
      <!-- 檢視切換器 -->
      <section class="task-view-section">
        <app-task-view-switcher></app-task-view-switcher>
      </section>
      
      <!-- 任務列表區域 -->
      <section class="task-list-section">
        <app-task-list></app-task-list>
      </section>
    </main>
  } @else {
    <div class="offline-message">
      <h3>⚠️ 無法連接到後端服務</h3>
      <p>請確保後端 API 服務正在運行，然後重新檢查連線。</p>
    </div>
  }

  <router-outlet />
</div>