# Story 1.1: 前後端開發環境建立

## Status
Done

## Story
**As a** 開發者，
**I want** 建立完整的 Angular 19 + .NET 9 開發環境，
**so that** 我可以開始實作業務功能並展示現代全端開發最佳實踐。

## Acceptance Criteria
1. Angular 19 前端專案成功建立並可在 port 4200 執行
2. .NET 9 後端 Web API 專案成功建立並可在 port 5000 執行
3. SQLite 資料庫連接配置完成
4. MediatR CQRS 基礎結構建立
5. 前後端可以成功通訊（基本健康檢查端點）
6. 基本專案結構符合架構文件規範
7. Docker 開發環境配置檔案建立

## Tasks / Subtasks
- [x] 建立前端 Angular 19 專案 (AC: 1)
  - [x] 使用 Angular CLI 建立新專案
  - [x] 配置 TypeScript 和 ESLint
  - [x] 設定基本路由結構
  - [x] 確認可在 port 4200 正常啟動
- [x] 建立後端 .NET 9 Web API 專案 (AC: 2, 3, 4)
  - [x] 建立 Web API 專案結構
  - [x] 安裝 MediatR 套件
  - [x] 配置 Entity Framework Core + SQLite
  - [x] 建立基本 CQRS 架構
  - [x] 設定 CORS 允許前端存取
  - [x] 確認可在 port 5000 正常啟動
- [x] 建立基本 API 健康檢查 (AC: 5)
  - [x] 實作 /api/health 端點
  - [x] 前端建立 API 服務測試連接
  - [x] 驗證前後端通訊正常
- [x] 驗證專案結構 (AC: 6)
  - [x] 檢查前端目錄結構符合架構規範
  - [x] 檢查後端分層架構符合 CQRS 模式
- [~] 建立 Docker 開發環境 (AC: 7) - 依使用者要求排除
  - [~] 建立前端 Dockerfile
  - [~] 建立後端 Dockerfile
  - [~] 建立 docker-compose.yml
  - [~] 驗證 Docker 環境可正常運作

## Dev Notes

### 專案結構指導 [Source: architecture.md#前端架構]
**前端結構** (Angular 19):
```
src/app/
├── core/                 # 核心模組 (單例服務)
│   ├── services/         # API 服務、HTTP 攔截器
│   ├── guards/           # 路由守衛
│   └── interceptors/     # HTTP 攔截器
├── shared/               # 共用模組
│   ├── components/       # 可重用元件
│   ├── pipes/            # 管道
│   └── directives/       # 指令
├── features/             # 功能模組 (依 Story 需求動態建立)
│   └── todo/             # 待辦事項功能 (Epic 1 開始建立)
└── layout/               # 佈局元件
```

**後端結構** [Source: architecture.md#後端架構]:
```
ToDoListBDD.API/
├── Controllers/              # API 控制器
├── Application/              # 應用層 (CQRS)
│   ├── Commands/             # 命令及處理器
│   ├── Queries/              # 查詢及處理器
│   ├── DTOs/                 # 資料傳輸物件
│   └── Interfaces/           # 應用介面
├── Domain/                   # 領域層
│   ├── Entities/             # 實體
│   ├── Enums/                # 列舉
│   └── Exceptions/           # 領域例外
├── Infrastructure/           # 基礎設施層
│   ├── Data/                 # EF Core 配置
│   ├── Repositories/         # 資料存取
│   └── Services/             # 外部服務
└── Presentation/            # 展示層
    ├── Filters/             # 過濾器
    └── Middleware/          # 中介軟體
```

### 技術棧配置 [Source: prd-final.md#technical-stack]
- **Frontend**: Angular 19.x + TypeScript 5.x
- **Backend**: .NET 9.x + MediatR 12.x
- **Database**: SQLite 3.x + Entity Framework Core 9.x
- **API**: RESTful API 風格
- **容器化**: Docker + Docker Compose

### CQRS 架構指導 [Source: architecture.md#cqrs-實作指導原則]
基本 MediatR 設定：
```csharp
// Program.cs 必須包含
services.AddMediatR(cfg => cfg.RegisterServicesFromAssembly(Assembly.GetExecutingAssembly()));
```

健康檢查端點架構：
```csharp
// 基本健康檢查控制器範例
[ApiController]
[Route("api/[controller]")]
public class HealthController : ControllerBase
{
    [HttpGet]
    public IActionResult Get()
    {
        return Ok(new { Status = "Healthy", Timestamp = DateTime.UtcNow });
    }
}
```

### 開發環境配置 [Source: architecture.md#開發環境配置]
**前端**:
- 開發服務器必須使用 port 4200 [Source: CLAUDE.md#前端開發環境]
- 指令: `ng serve --port 4200`

**後端**:
- API 服務器使用 port 5000
- launchSettings.json 配置開發環境

### Docker 配置 [Source: architecture.md#docker-compose-設置]
必須建立的檔案：
- `Dockerfile` (前端 - 使用 nginx)
- `Dockerfile` (後端 - 使用 .NET 9 runtime)
- `docker-compose.yml` (整合開發環境)

### Testing
**測試標準** [Source: prd-final.md#testing-strategy]:
- **Frontend Testing**: Jasmine + Karma (Angular 預設)
- **Backend Testing**: xUnit (最新版本)
- **Testing Coverage**: 單元測試覆蓋率最低 80%

**測試檔案位置**:
- 前端測試: 與元件同目錄 `.spec.ts`
- 後端測試: 獨立測試專案 `ToDoListBDD.Tests`

**此 Story 測試需求**:
- 前端環境啟動測試
- 後端 API 健康檢查測試
- Docker 環境整合測試

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-21 | 1.0 | 初始故事建立 | Scrum Master |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-20250514 (James - Full Stack Developer)

### Debug Log References
- 前端測試: 4 項測試全部通過
- 後端測試: 2 項測試全部通過  
- API 健康檢查: http://localhost:5000/api/health 回應正常
- CORS 配置: 已允許 http://localhost:4200 存取

### Completion Notes List
- ✅ Angular 19 前端專案成功建立，使用 standalone components 架構
- ✅ .NET 9 後端 Web API 專案建立，包含完整 CQRS 目錄結構
- ✅ MediatR 13.0.0 與 Entity Framework Core 9.0.8 成功配置
- ✅ SQLite 資料庫連線字串已設定
- ✅ 前端在 port 4200，後端在 port 5000 正常運行
- ✅ 健康檢查端點 `/api/health` 實作完成並測試通過
- ✅ 前後端 CORS 通訊配置完成並驗證正常

### File List
**前端檔案 (src/frontend/):**
- src/app/app.ts - 主要 App 元件，包含 API 健康檢查功能
- src/app/app.html - 應用程式範本，顯示 API 狀態
- src/app/app.scss - 應用程式樣式
- src/app/app.config.ts - 應用程式配置，包含 HttpClient 提供者
- src/app/core/services/api.ts - API 服務，包含健康檢查方法
- src/app/core/services/api.spec.ts - API 服務單元測試
- src/app/app.spec.ts - App 元件單元測試
- package.json - 專案依賴，包含 Angular 19 和 ESLint
- eslint.config.js - ESLint 配置檔案

**後端檔案 (src/backend/):**
- ToDoListBDD.API/Program.cs - 主要啟動檔案，包含 MediatR、EF Core、CORS 配置
- ToDoListBDD.API/Controllers/HealthController.cs - 健康檢查控制器
- ToDoListBDD.API/Infrastructure/Data/ApplicationDbContext.cs - EF Core 資料庫上下文
- ToDoListBDD.API/appsettings.json - 應用程式設定，包含 SQLite 連線字串
- ToDoListBDD.API/Properties/launchSettings.json - 開發環境設定 (port 5000)
- ToDoListBDD.API/ToDoListBDD.API.csproj - 專案檔案，包含所有 NuGet 套件
- ToDoListBDD.Tests/HealthControllerTests.cs - 健康檢查控制器測試
- ToDoListBDD.Tests/ToDoListBDD.Tests.csproj - 測試專案檔案
- ToDoListBDD.sln - 解決方案檔案

## QA Results
_待 QA 代理填寫_