# Story 2.3: ç·¨è¼¯ä»»å‹™å…§å®¹åŠŸèƒ½

## Status
Draft

## Story
**As a** ç”Ÿç”¢åŠ›ä½¿ç”¨è€…ï¼Œ
**I want** é›™æ“Šä»»å‹™æ–‡å­—é€²è¡Œå…§è¯ç·¨è¼¯ä¾†ä¿®æ”¹ä»»å‹™æè¿°ï¼Œ
**so that** æˆ‘å¯ä»¥æ›´æ–°æˆ–ä¿®æ­£ä»»å‹™è³‡è¨Šè€Œä¸éœ€é‡æ–°å»ºç«‹ä»»å‹™ã€‚

## Acceptance Criteria
1. é›™æ“Šä»»å‹™æ–‡å­—æ™‚é€²å…¥ç·¨è¼¯æ¨¡å¼ï¼Œé¡¯ç¤ºå…§è¯ç·¨è¼¯è¼¸å…¥æ¡†
2. ç·¨è¼¯è¼¸å…¥æ¡†åŒ…å«åŸå§‹ä»»å‹™æ–‡å­—ä¸”ç²å¾—ç„¦é»
3. æŒ‰ Enter éµä¿å­˜è®Šæ›´ä¸¦é€€å‡ºç·¨è¼¯æ¨¡å¼
4. æŒ‰ Escape éµå–æ¶ˆè®Šæ›´ä¸¦é€€å‡ºç·¨è¼¯æ¨¡å¼
5. é»æ“Šè¼¸å…¥æ¡†å¤–éƒ¨è‡ªå‹•ä¿å­˜è®Šæ›´ä¸¦é€€å‡ºç·¨è¼¯æ¨¡å¼
6. ç·¨è¼¯æ™‚é©—è­‰ä»»å‹™æè¿°ä¸å¯ç‚ºç©ºç™½æˆ–åƒ…åŒ…å«ç©ºæ ¼
7. ä»»å‹™æ›´æ–°å¾Œé¡¯ç¤ºæ–°çš„ä»»å‹™æ–‡å­—å…§å®¹
8. ç‹€æ…‹è®Šæ›´å³æ™‚åŒæ­¥åˆ°å¾Œç«¯ API å’Œè³‡æ–™åº«
9. ç¶²è·¯éŒ¯èª¤æ™‚å…§å®¹å›æ»¾ä¸¦é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
10. ç·¨è¼¯æ¨¡å¼ä¸­ä»»å‹™é …ç›®æœ‰æ˜é¡¯çš„è¦–è¦ºæŒ‡ç¤ºï¼ˆé‚Šæ¡†é«˜äº®ï¼‰
11. æ”¯æ´ Ctrl+Z æ’¤éŠ·ç·¨è¼¯æ“ä½œ
12. ç·¨è¼¯è®Šæ›´æ™‚æ›´æ–°ä»»å‹™çš„ UpdatedAt æ™‚é–“æˆ³è¨˜

## Tasks / Subtasks
- [ ] æ“´å±•å¾Œç«¯ CQRS å‘½ä»¤è™•ç† (AC: 8, 12)
  - [ ] å»ºç«‹ UpdateTaskDescriptionCommand å‘½ä»¤
  - [ ] å¯¦ä½œ UpdateTaskDescriptionCommandHandler
  - [ ] å»ºç«‹ UpdateTaskDescriptionCommandValidator é©—è­‰å™¨
  - [ ] ç¢ºä¿ä»»å‹™æè¿°ä¸ç‚ºç©ºç™½çš„é©—è­‰é‚è¼¯
- [ ] å¯¦ä½œ REST API ç«¯é» (AC: 8, 9)
  - [ ] åœ¨ TasksController æ–°å¢ PATCH /api/tasks/{id}/description ç«¯é»
  - [ ] å¯¦ä½œä»»å‹™ ID é©—è­‰é‚è¼¯
  - [ ] æ–°å¢æè¿°æ›´æ–°éŒ¯èª¤è™•ç†
  - [ ] ç¢ºä¿è³‡æ–™åº«äº‹å‹™å®Œæ•´æ€§
- [ ] æ“´å±•å‰ç«¯ä»»å‹™æœå‹™ (AC: 8, 9)
  - [ ] åœ¨ TaskService æ–°å¢ updateTaskDescription API æ–¹æ³•
  - [ ] å¯¦ä½œæ¨‚è§€æ›´æ–°å’ŒéŒ¯èª¤å›æ»¾æ©Ÿåˆ¶
  - [ ] æ–°å¢è¼‰å…¥ç‹€æ…‹ç®¡ç†
  - [ ] å¯¦ä½œé‡è©¦æ©Ÿåˆ¶
- [ ] å¯¦ä½œå…§è¯ç·¨è¼¯å…ƒä»¶åŠŸèƒ½ (AC: 1, 2, 10)
  - [ ] åœ¨ TaskListComponent æ–°å¢é›™æ“Šäº‹ä»¶è™•ç†
  - [ ] å»ºç«‹å…§è¯ç·¨è¼¯ç‹€æ…‹ç®¡ç†
  - [ ] å¯¦ä½œç·¨è¼¯æ¨¡å¼åˆ‡æ›é‚è¼¯
  - [ ] æ–°å¢ç·¨è¼¯ä¸­çš„è¦–è¦ºæŒ‡ç¤ºæ¨£å¼
- [ ] å¯¦ä½œç·¨è¼¯æ“ä½œæ§åˆ¶ (AC: 3, 4, 5, 11)
  - [ ] å¯¦ä½œ Enter éµä¿å­˜åŠŸèƒ½
  - [ ] å¯¦ä½œ Escape éµå–æ¶ˆåŠŸèƒ½
  - [ ] å¯¦ä½œé»æ“Šå¤–éƒ¨è‡ªå‹•ä¿å­˜
  - [ ] æ–°å¢ Ctrl+Z æ’¤éŠ·åŠŸèƒ½
- [ ] å¯¦ä½œè¼¸å…¥é©—è­‰å’ŒéŒ¯èª¤è™•ç† (AC: 6, 9)
  - [ ] æ–°å¢å‰ç«¯è¼¸å…¥é©—è­‰é‚è¼¯
  - [ ] å¯¦ä½œç©ºç™½å…§å®¹é©—è­‰æç¤º
  - [ ] æ–°å¢ç¶²è·¯éŒ¯èª¤å›æ»¾æ©Ÿåˆ¶
  - [ ] å¯¦ä½œéŒ¯èª¤è¨Šæ¯é¡¯ç¤º
- [ ] å¯¦ä½œè¦–è¦ºå›é¥‹å’Œå‹•ç•« (AC: 7, 10)
  - [ ] å»ºç«‹ç·¨è¼¯æ¨¡å¼çš„CSSæ¨£å¼
  - [ ] å¯¦ä½œç·¨è¼¯æ¡†ç²å¾—ç„¦é»çš„è¦–è¦ºæ•ˆæœ
  - [ ] æ–°å¢ä¿å­˜æˆåŠŸçš„è¦–è¦ºå›é¥‹
  - [ ] å„ªåŒ–ç·¨è¼¯æ¨¡å¼çš„ç”¨æˆ¶é«”é©—
- [ ] æ•´åˆå‰å¾Œç«¯åŠŸèƒ½æ¸¬è©¦ (AC: 1-12)
  - [ ] æ¸¬è©¦å®Œæ•´çš„ç·¨è¼¯æµç¨‹
  - [ ] é©—è­‰è¼¸å…¥é©—è­‰å’ŒéŒ¯èª¤è™•ç†
  - [ ] æ¸¬è©¦éµç›¤å¿«æ·éµåŠŸèƒ½
  - [ ] ç¢ºèªè³‡æ–™æŒä¹…åŒ–å’ŒåŒæ­¥

## Dev Notes

### ä¾è³´å‰ä¸€å€‹æ•…äº‹
æ­¤æ•…äº‹ä¾è³´ **Story 2.1** å’Œ **Story 2.2** çš„å®Œæˆï¼š
- éœ€è¦ TodoTask è³‡æ–™æ¨¡å‹å’Œè³‡æ–™åº«çµæ§‹
- éœ€è¦åŸºæœ¬çš„ CQRS æ¶æ§‹å’Œ MediatR é…ç½®
- éœ€è¦ TasksController å’ŒåŸºæœ¬ API çµæ§‹
- éœ€è¦å‰ç«¯ TaskService å’ŒåŸºæœ¬å…ƒä»¶çµæ§‹
- éœ€è¦ä»»å‹™ç‹€æ…‹ç®¡ç†åŠŸèƒ½

### BDD æ¸¬è©¦å ´æ™¯æ¡†æ¶
æ­¤æ•…äº‹åŸºæ–¼ä»¥ä¸‹ BDD æ¸¬è©¦å ´æ™¯å¯¦ä½œï¼š

**ä¸»è¦æ¸¬è©¦å ´æ™¯ï¼š**
```gherkin
Feature: å…§è¯ç·¨è¼¯ä»»å‹™å…§å®¹
  As a ç”Ÿç”¢åŠ›ä½¿ç”¨è€…
  I want to ç·¨è¼¯ä»»å‹™æè¿°
  So that æˆ‘å¯ä»¥æ›´æ–°ä»»å‹™è³‡è¨Š

Scenario: å•Ÿå‹•å…§è¯ç·¨è¼¯æ¨¡å¼
  Given æˆ‘æœ‰ä¸€å€‹ä»»å‹™ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  When æˆ‘é›™æ“Šä»»å‹™æ–‡å­—
  Then æ‡‰è©²é¡¯ç¤ºå…§è¯ç·¨è¼¯è¼¸å…¥æ¡†
  And è¼¸å…¥æ¡†æ‡‰è©²åŒ…å« "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  And è¼¸å…¥æ¡†æ‡‰è©²ç²å¾—ç„¦é»
  And ä»»å‹™é …ç›®æ‡‰è©²é¡¯ç¤ºç·¨è¼¯æ¨¡å¼é«˜äº®

Scenario: ä½¿ç”¨ Enter éµä¿å­˜ç·¨è¼¯
  Given æˆ‘æ­£åœ¨ç·¨è¼¯ä»»å‹™ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  When æˆ‘ä¿®æ”¹æ–‡å­—ç‚º "å®Œæˆå­£åº¦å°ˆæ¡ˆå ±å‘Š"
  And æˆ‘æŒ‰ä¸‹ Enter éµ
  Then ç·¨è¼¯æ¨¡å¼æ‡‰è©²çµæŸ
  And ä»»å‹™æ–‡å­—æ‡‰è©²æ›´æ–°ç‚º "å®Œæˆå­£åº¦å°ˆæ¡ˆå ±å‘Š"
  And æ‡‰è©²é¡¯ç¤ºä¿å­˜æˆåŠŸçš„è¦–è¦ºå›é¥‹

Scenario: ä½¿ç”¨ Escape éµå–æ¶ˆç·¨è¼¯
  Given æˆ‘æ­£åœ¨ç·¨è¼¯ä»»å‹™ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  When æˆ‘ä¿®æ”¹æ–‡å­—ç‚º "ä¿®æ”¹å¾Œçš„å…§å®¹"
  And æˆ‘æŒ‰ä¸‹ Escape éµ
  Then ç·¨è¼¯æ¨¡å¼æ‡‰è©²çµæŸ
  And ä»»å‹™æ–‡å­—æ‡‰è©²ä¿æŒ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  And ä¿®æ”¹æ‡‰è©²è¢«å–æ¶ˆ

Scenario: é»æ“Šå¤–éƒ¨è‡ªå‹•ä¿å­˜
  Given æˆ‘æ­£åœ¨ç·¨è¼¯ä»»å‹™ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  When æˆ‘ä¿®æ”¹æ–‡å­—ç‚º "æ›´æ–°çš„å ±å‘Šå…§å®¹"
  And æˆ‘é»æ“Šä»»å‹™é …ç›®å¤–éƒ¨å€åŸŸ
  Then ç·¨è¼¯æ¨¡å¼æ‡‰è©²çµæŸ
  And ä»»å‹™æ–‡å­—æ‡‰è©²æ›´æ–°ç‚º "æ›´æ–°çš„å ±å‘Šå…§å®¹"

Scenario: é©—è­‰ç©ºç™½å…§å®¹
  Given æˆ‘æ­£åœ¨ç·¨è¼¯ä»»å‹™ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  When æˆ‘æ¸…ç©ºæ‰€æœ‰æ–‡å­—
  And æˆ‘æŒ‰ä¸‹ Enter éµ
  Then æ‡‰è©²é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ "ä»»å‹™æè¿°ä¸å¯ç‚ºç©º"
  And ç·¨è¼¯æ¨¡å¼æ‡‰è©²ä¿æŒ
  And è¼¸å…¥æ¡†æ‡‰è©²é‡æ–°ç²å¾—ç„¦é»

Scenario: ç¶²è·¯éŒ¯èª¤æ™‚å…§å®¹å›æ»¾
  Given æˆ‘æ­£åœ¨ç·¨è¼¯ä»»å‹™ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  When API æœå‹™ç„¡æ³•å›æ‡‰
  And æˆ‘ä¿®æ”¹æ–‡å­—ç‚º "æ–°çš„å…§å®¹"
  And æˆ‘æŒ‰ä¸‹ Enter éµ
  Then æ‡‰è©²é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ "æ›´æ–°å¤±æ•—ï¼Œè«‹é‡è©¦"
  And ä»»å‹™æ–‡å­—æ‡‰è©²å›æ»¾åˆ° "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  And ç·¨è¼¯æ¨¡å¼æ‡‰è©²çµæŸ

Scenario: æ’¤éŠ·ç·¨è¼¯æ“ä½œ
  Given æˆ‘æ­£åœ¨ç·¨è¼¯ä»»å‹™ "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  When æˆ‘ä¿®æ”¹æ–‡å­—ç‚º "ä¿®æ”¹å¾Œçš„å…§å®¹"
  And æˆ‘æŒ‰ä¸‹ Ctrl+Z
  Then è¼¸å…¥æ¡†å…§å®¹æ‡‰è©²æ¢å¾©åˆ° "å®Œæˆå°ˆæ¡ˆå ±å‘Š"
  And ç·¨è¼¯æ¨¡å¼æ‡‰è©²ä¿æŒ
```

### æ“´å±•ç¾æœ‰è³‡æ–™æ¨¡å‹ [Source: Story 2.1 - TodoTask å¯¦é«”]
**ç¾æœ‰çš„ TodoTask å¯¦é«”å·²åŒ…å«å¿…è¦æ¬„ä½ï¼š**
```csharp
public class TodoTask
{
    public int Id { get; set; }
    public string Description { get; set; } = string.Empty;  // ç·¨è¼¯åŠŸèƒ½å°‡ä¿®æ”¹æ­¤æ¬„ä½
    public bool IsCompleted { get; set; } = false;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;  // éœ€è¦åœ¨ç·¨è¼¯æ™‚æ›´æ–°
}
```

### CQRS æ“´å±•å¯¦ä½œ [Source: architecture.md#CQRS å¯¦ä½œæŒ‡å°åŸå‰‡]
**UpdateTaskDescriptionCommand çµæ§‹ï¼š**
```csharp
public class UpdateTaskDescriptionCommand : IRequest<TaskDto>
{
    public int TaskId { get; set; }
    public string NewDescription { get; set; } = string.Empty;
}

public class UpdateTaskDescriptionCommandValidator : AbstractValidator<UpdateTaskDescriptionCommand>
{
    public UpdateTaskDescriptionCommandValidator()
    {
        RuleFor(x => x.TaskId)
            .GreaterThan(0).WithMessage("ä»»å‹™ ID å¿…é ˆå¤§æ–¼ 0");
            
        RuleFor(x => x.NewDescription)
            .NotEmpty().WithMessage("ä»»å‹™æè¿°ä¸å¯ç‚ºç©º")
            .NotNull().WithMessage("ä»»å‹™æè¿°ä¸å¯ç‚ºç©º")
            .Must(desc => !string.IsNullOrWhiteSpace(desc))
            .WithMessage("ä»»å‹™æè¿°ä¸å¯åƒ…åŒ…å«ç©ºæ ¼");
    }
}

public class UpdateTaskDescriptionCommandHandler : IRequestHandler<UpdateTaskDescriptionCommand, TaskDto>
{
    private readonly ITaskRepository _repository;
    
    public async Task<TaskDto> Handle(UpdateTaskDescriptionCommand request, CancellationToken cancellationToken)
    {
        var task = await _repository.GetByIdAsync(request.TaskId);
        if (task == null)
            throw new NotFoundException($"æ‰¾ä¸åˆ° ID ç‚º {request.TaskId} çš„ä»»å‹™");
            
        task.Description = request.NewDescription.Trim();
        task.UpdatedAt = DateTime.UtcNow;
        
        await _repository.UpdateAsync(task);
        return task.ToDto();
    }
}
```

### API ç«¯é»æ“´å±• [Source: architecture.md#API æ§åˆ¶å™¨æŒ‡å°åŸå‰‡]
**æ–°å¢ API ç«¯é»ï¼š**
- ç«¯é»ï¼š`PATCH /api/tasks/{id}/description`
- è«‹æ±‚é«”ï¼š`{ "newDescription": "æ›´æ–°çš„ä»»å‹™æè¿°" }`
- æˆåŠŸå›æ‡‰ï¼š`200 OK` + æ›´æ–°å¾Œçš„ TaskDto
- éŒ¯èª¤å›æ‡‰ï¼š`404 Not Found`ï¼ˆä»»å‹™ä¸å­˜åœ¨ï¼‰ã€`400 Bad Request`ï¼ˆé©—è­‰éŒ¯èª¤ï¼‰

```csharp
[HttpPatch("{id}/description")]
public async Task<ActionResult<TaskDto>> UpdateTaskDescription(int id, UpdateTaskDescriptionRequest request)
{
    var command = new UpdateTaskDescriptionCommand
    {
        TaskId = id,
        NewDescription = request.NewDescription
    };
    
    try
    {
        var result = await _mediator.Send(command);
        return Ok(result);
    }
    catch (NotFoundException)
    {
        return NotFound($"æ‰¾ä¸åˆ° ID ç‚º {id} çš„ä»»å‹™");
    }
    catch (ValidationException ex)
    {
        return BadRequest(ex.Message);
    }
}

public class UpdateTaskDescriptionRequest
{
    public string NewDescription { get; set; } = string.Empty;
}
```

### å‰ç«¯æœå‹™æ“´å±• [Source: architecture.md#ç‹€æ…‹ç®¡ç†ç­–ç•¥]
**TaskService æ–°å¢æ–¹æ³•ï¼š**
```typescript
export interface TaskService {
  // ç¾æœ‰æ–¹æ³•å¾ Story 2.1 å’Œ 2.2
  createTask(description: string): Observable<Task>;
  updateTaskStatus(taskId: number, isCompleted: boolean): Observable<Task>;
  
  // æ–°å¢æ–¹æ³•
  updateTaskDescription(taskId: number, newDescription: string): Observable<Task>;
}

// å¯¦ä½œæ¨‚è§€æ›´æ–°å’ŒéŒ¯èª¤å›æ»¾
updateTaskDescription(taskId: number, newDescription: string): Observable<Task> {
  // é©—è­‰è¼¸å…¥
  if (!newDescription || !newDescription.trim()) {
    return throwError(() => new Error('ä»»å‹™æè¿°ä¸å¯ç‚ºç©º'));
  }

  return this.http.patch<Task>(`/api/tasks/${taskId}/description`, { 
    newDescription: newDescription.trim() 
  }).pipe(
    tap(updatedTask => this.updateTaskInState(updatedTask)),
    catchError(error => {
      // éŒ¯èª¤è™•ç†é‚è¼¯
      return throwError(() => error);
    })
  );
}
```

### å‰ç«¯å…ƒä»¶æ“´å±• [Source: architecture.md#å‰ç«¯æ¶æ§‹]
**TaskListComponent æ–°å¢ç·¨è¼¯åŠŸèƒ½ï¼š**
```typescript
export class TaskListComponent {
  editingTaskId: number | null = null;
  editingValue: string = '';
  originalValue: string = '';

  // å•Ÿå‹•ç·¨è¼¯æ¨¡å¼
  startEditing(task: Task): void {
    this.editingTaskId = task.id;
    this.editingValue = task.description;
    this.originalValue = task.description;
    
    // ä¸‹ä¸€å€‹ tick å¾Œè¨­ç½®ç„¦é»
    setTimeout(() => {
      const input = document.querySelector(`[data-task-id="${task.id}"] input`) as HTMLInputElement;
      if (input) {
        input.focus();
        input.select();
      }
    });
  }

  // ä¿å­˜ç·¨è¼¯
  saveEdit(taskId: number): void {
    if (!this.editingValue.trim()) {
      this.showError('ä»»å‹™æè¿°ä¸å¯ç‚ºç©º');
      return;
    }

    this.taskService.updateTaskDescription(taskId, this.editingValue).subscribe({
      next: (updatedTask) => {
        this.exitEditMode();
        this.showSuccess('ä»»å‹™æ›´æ–°æˆåŠŸ');
      },
      error: (error) => {
        this.showError('æ›´æ–°å¤±æ•—ï¼Œè«‹é‡è©¦');
        this.editingValue = this.originalValue;
      }
    });
  }

  // å–æ¶ˆç·¨è¼¯
  cancelEdit(): void {
    this.editingValue = this.originalValue;
    this.exitEditMode();
  }

  // é€€å‡ºç·¨è¼¯æ¨¡å¼
  exitEditMode(): void {
    this.editingTaskId = null;
    this.editingValue = '';
    this.originalValue = '';
  }

  // éµç›¤äº‹ä»¶è™•ç†
  onEditKeyDown(event: KeyboardEvent, taskId: number): void {
    switch (event.key) {
      case 'Enter':
        event.preventDefault();
        this.saveEdit(taskId);
        break;
      case 'Escape':
        event.preventDefault();
        this.cancelEdit();
        break;
    }
  }

  // æ’¤éŠ·åŠŸèƒ½ï¼ˆCtrl+Zï¼‰
  @HostListener('keydown', ['$event'])
  onKeyDown(event: KeyboardEvent): void {
    if (event.ctrlKey && event.key === 'z' && this.editingTaskId) {
      event.preventDefault();
      this.editingValue = this.originalValue;
    }
  }

  // é»æ“Šå¤–éƒ¨è™•ç†
  @HostListener('document:click', ['$event'])
  onDocumentClick(event: MouseEvent): void {
    if (this.editingTaskId) {
      const target = event.target as HTMLElement;
      const editingInput = document.querySelector(`[data-task-id="${this.editingTaskId}"] input`);
      
      if (editingInput && !editingInput.contains(target)) {
        this.saveEdit(this.editingTaskId);
      }
    }
  }
}
```

### HTML æ¨¡æ¿çµæ§‹
**TaskListComponent æ¨¡æ¿ï¼š**
```html
<div class="task-item" 
     [class.editing]="editingTaskId === task.id" 
     *ngFor="let task of tasks" 
     [attr.data-task-id]="task.id">
  
  <!-- æ­£å¸¸é¡¯ç¤ºæ¨¡å¼ -->
  <span *ngIf="editingTaskId !== task.id"
        class="task-text"
        [class.completed]="task.isCompleted"
        (dblclick)="startEditing(task)"
        [attr.data-testid]="'task-text'">
    {{ task.description }}
  </span>
  
  <!-- ç·¨è¼¯æ¨¡å¼ -->
  <input *ngIf="editingTaskId === task.id"
         type="text"
         class="task-edit-input"
         [(ngModel)]="editingValue"
         (keydown)="onEditKeyDown($event, task.id)"
         (blur)="saveEdit(task.id)"
         [attr.data-testid]="'task-edit-input'"
         maxlength="200">
</div>
```

### CSS æ¨£å¼è¨­è¨ˆ
**ç·¨è¼¯æ¨¡å¼è¦–è¦ºæ•ˆæœï¼š**
```scss
.task-item {
  padding: 12px;
  border: 1px solid transparent;
  border-radius: 4px;
  transition: all 0.2s ease;
  
  &.editing {
    border-color: #3b82f6;
    background-color: #eff6ff;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
  }
  
  .task-text {
    display: block;
    cursor: text;
    padding: 4px;
    border-radius: 2px;
    transition: background-color 0.2s ease;
    
    &:hover {
      background-color: #f9fafb;
    }
    
    &.completed {
      text-decoration: line-through;
      opacity: 0.7;
      color: #6b7280;
    }
  }
  
  .task-edit-input {
    width: 100%;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    padding: 8px;
    font-size: inherit;
    font-family: inherit;
    
    &:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }
  }
}

.success-message {
  color: #10b981;
  font-size: 14px;
  margin-top: 4px;
}

.error-message {
  color: #ef4444;
  font-size: 14px;
  margin-top: 4px;
}
```

### æ¸¬è©¦è¦æ±‚ [Source: bdd-testing-strategy.md]
**å‰ç«¯ BDD æ¸¬è©¦ï¼š**
- æ¸¬è©¦æª”æ¡ˆï¼š`tests/frontend-bdd/features/task-inline-edit.feature`
- æ­¥é©Ÿå®šç¾©ï¼š`tests/frontend-bdd/step_definitions/task-inline-edit.steps.ts`
- é‡é»æ¸¬è©¦ï¼šé›™æ“Šç·¨è¼¯ã€éµç›¤æ“ä½œã€é©—è­‰é‚è¼¯ã€éŒ¯èª¤è™•ç†

**å¾Œç«¯ BDD æ¸¬è©¦ï¼š**
- æ¸¬è©¦æª”æ¡ˆï¼š`tests/backend-bdd/Features/TaskDescriptionUpdate.feature`
- æ­¥é©Ÿå®šç¾©ï¼š`tests/backend-bdd/StepDefinitions/TaskDescriptionUpdateSteps.cs`
- é‡é»æ¸¬è©¦ï¼šPATCH APIã€è³‡æ–™é©—è­‰ã€éŒ¯èª¤è™•ç†ã€æ™‚é–“æˆ³æ›´æ–°

**E2E BDD æ¸¬è©¦ï¼š**
- å®Œæ•´ç·¨è¼¯æµç¨‹æ¸¬è©¦
- å¤šä»»å‹™ç·¨è¼¯å ´æ™¯
- éŒ¯èª¤æ¢å¾©é©—è­‰

### æ•ˆèƒ½è€ƒé‡
**å‰ç«¯æ•ˆèƒ½ï¼š**
- ç·¨è¼¯ç‹€æ…‹ä½¿ç”¨æœ¬åœ°çµ„ä»¶ç‹€æ…‹é¿å…é »ç¹ç‹€æ…‹æ›´æ–°
- è¼¸å…¥é˜²æŠ–å‹•é¿å…éå¤š API èª¿ç”¨
- ä½¿ç”¨ OnPush è®Šæ›´æª¢æ¸¬ç­–ç•¥

**å¾Œç«¯æ•ˆèƒ½ï¼š**
- æè¿°å­—æ®µé•·åº¦é™åˆ¶ï¼ˆ200å­—ç¬¦ï¼‰
- è³‡æ–™åº«ç´¢å¼•å„ªåŒ– TaskId æŸ¥è©¢
- è¼¸å…¥æ¸…ç†å’Œé©—è­‰

### ç„¡éšœç¤™æ€§æ”¯æ´
**éµç›¤å°èˆªï¼š**
- Tab éµå¯å°èˆªåˆ°ä»»å‹™é …ç›®
- é›™æ“Šæˆ– F2 éµå•Ÿå‹•ç·¨è¼¯æ¨¡å¼
- Enter ä¿å­˜ï¼ŒEscape å–æ¶ˆ

**è¢å¹•é–±è®€å™¨ï¼š**
- ç·¨è¼¯æ¨¡å¼ç‹€æ…‹é€šçŸ¥
- é©ç•¶çš„ ARIA æ¨™ç±¤
- éŒ¯èª¤è¨Šæ¯çš„ç„¡éšœç¤™é€šçŸ¥

### Testing
**æ¸¬è©¦æ¨™æº–ï¼š** [Source: bdd-testing-strategy.md]
- å‰ç«¯æ¸¬è©¦ï¼šJasmine + Karma (Angular é è¨­)
- å¾Œç«¯æ¸¬è©¦ï¼šxUnit (.NET æ¨™æº–æ¸¬è©¦æ¡†æ¶)
- BDD æ¸¬è©¦ï¼šSpecFlow (å¾Œç«¯) + Cucumber (å‰ç«¯)
- E2E æ¸¬è©¦ï¼šSpecFlow + Selenium WebDriver

**æ­¤æ•…äº‹çš„ç‰¹å®šæ¸¬è©¦éœ€æ±‚ï¼š**
- å…§è¯ç·¨è¼¯åŠŸèƒ½çš„å–®å…ƒæ¸¬è©¦
- UpdateTaskDescriptionCommand çš„æ•´åˆæ¸¬è©¦
- å‰ç«¯ç·¨è¼¯äº’å‹•æ¸¬è©¦
- éµç›¤å¿«æ·éµæ¸¬è©¦
- è¼¸å…¥é©—è­‰æ¸¬è©¦
- éŒ¯èª¤è™•ç†å’Œå›æ»¾æ©Ÿåˆ¶æ¸¬è©¦
- æ¨‚è§€æ›´æ–°çš„æ­£ç¢ºæ€§æ¸¬è©¦

**âš ï¸ DEV éœ€è¦è£œå®Œçš„é—œéµæŠ€è¡“ç´°ç¯€ï¼š**

1. **API éŸ¿æ‡‰æ ¼å¼æ¨™æº–åŒ–** - éœ€è¦ç¢ºèªæ‰€æœ‰ API ç«¯é»çš„éŸ¿æ‡‰æ ¼å¼ä¸€è‡´æ€§
2. **éŒ¯èª¤è™•ç†çµ±ä¸€åŒ–** - éœ€è¦å»ºç«‹çµ±ä¸€çš„å‰ç«¯éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
3. **è¼‰å…¥ç‹€æ…‹ç®¡ç†** - éœ€è¦å¯¦ä½œç·¨è¼¯éç¨‹ä¸­çš„è¼‰å…¥ç‹€æ…‹æŒ‡ç¤ºå™¨
4. **è³‡æ–™åº«é·ç§»è…³æœ¬** - å¦‚æœéœ€è¦ä¿®æ”¹ TaskDescription æ¬„ä½ç´„æŸ
5. **E2E æ¸¬è©¦ç’°å¢ƒè¨­ç½®** - éœ€è¦é…ç½®å®Œæ•´çš„æ¸¬è©¦ç’°å¢ƒä»¥æ”¯æ´ç·¨è¼¯åŠŸèƒ½æ¸¬è©¦
6. **æ•ˆèƒ½ç›£æ§** - éœ€è¦åŠ å…¥ç·¨è¼¯æ“ä½œçš„æ•ˆèƒ½è¿½è¹¤æŒ‡æ¨™

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-21 | 1.0 | åˆå§‹æ•…äº‹å»ºç«‹ï¼ŒåŒ…å«å®Œæ•´ BDD å ´æ™¯æ¡†æ¶å’Œå¯¦ä½œæŒ‡å° | Scrum Master |

## Dev Agent Record

### Agent Model Used
_å¾…é–‹ç™¼ä»£ç†å¡«å¯«_

### Debug Log References
_å¾…é–‹ç™¼ä»£ç†å¡«å¯«_

### Completion Notes List
_å¾…é–‹ç™¼ä»£ç†å¡«å¯«_

### File List
_å¾…é–‹ç™¼ä»£ç†å¡«å¯«_

## QA Results

### Review Date: 2025-08-21

### Reviewed By: Quinn (Test Architect)

### å¯©æŸ¥å‰ææ¢ä»¶æª¢æŸ¥

**âš ï¸ é˜»å¡æ¢ä»¶è­˜åˆ¥:**
- æ•…äº‹ç‹€æ…‹ç‚º "Draft"ï¼Œä¸ç¬¦åˆå¯©æŸ¥å‰ææ¢ä»¶ï¼ˆéœ€è¦ "Review" ç‹€æ…‹ï¼‰
- ç¼ºå°‘å®Œæ•´çš„æª”æ¡ˆå¯¦ä½œåˆ—è¡¨ï¼ˆFile List ç‚ºç©ºï¼‰
- å°šç„¡ç›¸é—œçš„ç¨‹å¼ç¢¼å¯¦ä½œæª”æ¡ˆ
- ç„¡ç›¸é—œæ¸¬è©¦æª”æ¡ˆå­˜åœ¨

### é¢¨éšªè©•ä¼°åˆ†æ

**è‡ªå‹•å‡ç´šåˆ°æ·±åº¦å¯©æŸ¥æ¢ä»¶:**
- âœ“ æ•…äº‹åŒ…å« >5 å€‹é©—æ”¶æ¨™æº–ï¼ˆ12å€‹ï¼‰- è§¸ç™¼æ·±åº¦å¯©æŸ¥
- âœ“ æ²’æœ‰ç›¸é—œå¯¦ä½œç¨‹å¼ç¢¼å’Œæ¸¬è©¦ - è§¸ç™¼æ·±åº¦å¯©æŸ¥

**é¢¨éšªè©•ä¼°çŸ©é™£:**

| é¢¨éšªé¡åˆ¥ | é¢¨éšªç­‰ç´š | èªªæ˜ |
|---------|---------|------|
| æŠ€è¡“å¯¦ä½œè¤‡é›œåº¦ | HIGH (8/10) | å…§è¯ç·¨è¼¯åŠŸèƒ½æ¶‰åŠå‰å¾Œç«¯ã€UI/UXã€é©—è­‰ã€éŒ¯èª¤è™•ç†ç­‰å¤šå€‹æŠ€è¡“é¢å‘ |
| ç”¨æˆ¶é«”é©—é¢¨éšª | MEDIUM (6/10) | éµç›¤æ“ä½œã€ç„¦é»ç®¡ç†ã€è¦–è¦ºå›é¥‹ç­‰éœ€è¦ç²¾å¯†çš„ç”¨æˆ¶é«”é©—è¨­è¨ˆ |
| è³‡æ–™å®Œæ•´æ€§é¢¨éšª | MEDIUM (5/10) | æ¨‚è§€æ›´æ–°å’ŒéŒ¯èª¤å›æ»¾æ©Ÿåˆ¶éœ€è¦ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§ |
| æ¸¬è©¦è¦†è“‹é¢¨éšª | HIGH (9/10) | è¤‡é›œçš„å‰ç«¯äº’å‹•è¡Œç‚ºéœ€è¦å…¨é¢çš„æ¸¬è©¦è¦†è“‹ |

### éœ€æ±‚è¿½è¹¤æ€§åˆ†æ

**é©—æ”¶æ¨™æº–è¦†è“‹åº¦è©•ä¼°:**
- AC 1-12: ç„¡å°æ‡‰æ¸¬è©¦å¯¦ä½œ âŒ
- ç¼ºå°‘ä»¥ä¸‹é—œéµæ¸¬è©¦å ´æ™¯æ˜ å°„:
  - é›™æ“Šç·¨è¼¯åŠŸèƒ½æ¸¬è©¦
  - éµç›¤å¿«æ·éµäº’å‹•æ¸¬è©¦
  - è¼¸å…¥é©—è­‰å’ŒéŒ¯èª¤è™•ç†æ¸¬è©¦
  - ç¶²è·¯éŒ¯èª¤å›æ»¾æ¸¬è©¦

### ç¨‹å¼ç¢¼å“è³ªè©•ä¼°

**æ¶æ§‹è¨­è¨ˆè©•ä¼°:**
- âœ“ CQRS æ¶æ§‹è¨­è¨ˆç¬¦åˆå°ˆæ¡ˆæ¨™æº–
- âœ“ å‰ç«¯ä½¿ç”¨ Angular Signals ç‹€æ…‹ç®¡ç†
- âœ“ RESTful API è¨­è¨ˆç¬¦åˆå°ˆæ¡ˆæ…£ä¾‹

**å¯¦ä½œç¼ºå£è­˜åˆ¥:**
1. **å¾Œç«¯å¯¦ä½œç¼ºå°‘:**
   - UpdateTaskDescriptionCommand å‘½ä»¤
   - UpdateTaskDescriptionCommandHandler è™•ç†å™¨
   - UpdateTaskDescriptionCommandValidator é©—è­‰å™¨
   - TasksController çš„ PATCH /description ç«¯é»

2. **å‰ç«¯å¯¦ä½œç¼ºå°‘:**
   - TaskService çš„ updateTaskDescription æ–¹æ³•
   - TaskListComponent çš„ç·¨è¼¯åŠŸèƒ½
   - ç·¨è¼¯æ¨¡å¼çš„ CSS æ¨£å¼
   - éµç›¤äº‹ä»¶è™•ç†é‚è¼¯

### æ¸¬è©¦æ¶æ§‹è©•ä¼°

**æ¸¬è©¦å±¤ç´šé©ç•¶æ€§:**
- E2E æ¸¬è©¦: éœ€è¦å®Œæ•´ç·¨è¼¯æµç¨‹æ¸¬è©¦ ğŸ“ è¨ˆåŠƒä¸­
- å‰ç«¯ BDD æ¸¬è©¦: éœ€è¦ UI äº’å‹•è¡Œç‚ºæ¸¬è©¦ ğŸ“ è¨ˆåŠƒä¸­  
- å¾Œç«¯ BDD æ¸¬è©¦: éœ€è¦ API è¡Œç‚ºé©—è­‰æ¸¬è©¦ ğŸ“ è¨ˆåŠƒä¸­
- å–®å…ƒæ¸¬è©¦: éœ€è¦å…ƒä»¶å’Œæœå‹™å±¤æ¸¬è©¦ ğŸ“ è¨ˆåŠƒä¸­

**æ¸¬è©¦è¨­è¨ˆå“è³ª:**
- BDD å ´æ™¯è¦†è“‹åº¦ï¼šå„ªç§€ âœ“
- Gherkin èªæ³•å“è³ªï¼šå„ªç§€ âœ“
- æ¸¬è©¦è³‡æ–™ç®¡ç†ç­–ç•¥ï¼šéœ€è¦è¦åŠƒ ğŸ“

### éåŠŸèƒ½æ€§éœ€æ±‚é©—è­‰

**å®‰å…¨æ€§ (Security): éœ€è¦é—œæ³¨**
- è¼¸å…¥é©—è­‰ï¼šå‰å¾Œç«¯é›™é‡é©—è­‰æ©Ÿåˆ¶å·²è¦åŠƒ âœ“
- è³‡æ–™æ¸…ç†ï¼štrim() å’Œé•·åº¦é™åˆ¶å·²è€ƒæ…® âœ“  
- SQL æ³¨å…¥é˜²è­·ï¼šEntity Framework æä¾›ä¿è­· âœ“

**æ•ˆèƒ½ (Performance): è‰¯å¥½**
- æ¨‚è§€æ›´æ–°ç­–ç•¥æ¸›å°‘ä½¿ç”¨è€…æ„ŸçŸ¥å»¶é² âœ“
- æœ¬åœ°ç‹€æ…‹ç®¡ç†é¿å…ä¸å¿…è¦çš„ API å‘¼å« âœ“
- éœ€è¦æ·»åŠ é˜²æŠ–å‹•æ©Ÿåˆ¶é¿å…é »ç¹ API è«‹æ±‚ ğŸ“

**å¯é æ€§ (Reliability): è‰¯å¥½**  
- éŒ¯èª¤å›æ»¾æ©Ÿåˆ¶å·²è¦åŠƒ âœ“
- ç¶²è·¯éŒ¯èª¤è™•ç†ç­–ç•¥å®Œæ•´ âœ“
- è¼¸å…¥é©—è­‰å¤šå±¤é˜²è­· âœ“

**å¯ç¶­è­·æ€§ (Maintainability): å„ªç§€**
- é—œæ³¨é»åˆ†é›¢æ¸…æ¥š âœ“
- CQRS æ¶æ§‹æä¾›è‰¯å¥½å¯æ“´å±•æ€§ âœ“
- ç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°æ˜“æ‡‚ âœ“

### å¯æ¸¬è©¦æ€§è©•ä¼°

**æ§åˆ¶èƒ½åŠ› (Controllability):** è‰¯å¥½
- API ç«¯é»å¯æ§åˆ¶è¼¸å…¥åƒæ•¸ âœ“
- å‰ç«¯å…ƒä»¶æ”¯æ´å±¬æ€§æ³¨å…¥æ¸¬è©¦ âœ“

**è§€å¯Ÿèƒ½åŠ› (Observability):** å„ªç§€  
- API å›æ‡‰å¯è§€å¯Ÿ âœ“
- å‰ç«¯ç‹€æ…‹è®Šæ›´å¯è§€å¯Ÿ âœ“
- éŒ¯èª¤ç‹€æ…‹å¯è§€å¯Ÿ âœ“

**é™¤éŒ¯èƒ½åŠ› (Debuggability):** è‰¯å¥½
- æ¸…æ¥šçš„éŒ¯èª¤è¨Šæ¯è¨­è¨ˆ âœ“
- å‰ç«¯ç‹€æ…‹å¯è¿½è¹¤ âœ“

### æŠ€è¡“å‚µå‹™è­˜åˆ¥

**ç•¶å‰æŠ€è¡“å‚µå‹™:**
1. ç¼ºå°‘å®Œæ•´å¯¦ä½œï¼ˆé æœŸä¸­ï¼‰
2. TasksController ç¼ºå°‘ GetTask å¯¦ä½œï¼ˆä¾†è‡ªå‰æœŸæ•…äº‹ï¼‰
3. å‰ç«¯éŒ¯èª¤è™•ç†æ©Ÿåˆ¶éœ€è¦æ¨™æº–åŒ–

**æ½›åœ¨æŠ€è¡“å‚µå‹™é é˜²:**
1. éœ€è¦åˆ¶å®šä¸€è‡´çš„ API éŸ¿æ‡‰æ ¼å¼æ¨™æº–
2. éœ€è¦çµ±ä¸€çš„å‰ç«¯éŒ¯èª¤è™•ç†ç­–ç•¥
3. éœ€è¦ç·¨è¼¯æ“ä½œçš„æ•ˆèƒ½ç›£æ§æ©Ÿåˆ¶

### æ¨™æº–åˆè¦æ€§æª¢æŸ¥

- **ç·¨ç¢¼æ¨™æº–**: âœ“ ç¬¦åˆï¼ˆåŸºæ–¼ç¾æœ‰ç¨‹å¼ç¢¼çµæ§‹ï¼‰
- **å°ˆæ¡ˆçµæ§‹**: âœ“ ç¬¦åˆçµ±ä¸€å°ˆæ¡ˆçµæ§‹
- **æ¸¬è©¦ç­–ç•¥**: âœ“ ç¬¦åˆ BDD æ¸¬è©¦ç­–ç•¥
- **æ¶æ§‹æŒ‡å°åŸå‰‡**: âœ“ ç¬¦åˆ CQRS å’Œåˆ†å±¤æ¶æ§‹

### æ”¹é€²å»ºè­°æ¸…å–®

**ç«‹å³è™•ç†é …ç›®ï¼ˆé˜»å¡ç™¼å¸ƒï¼‰:**
- [ ] å®Œæˆå¾Œç«¯ UpdateTaskDescription CQRS å¯¦ä½œ
- [ ] å®Œæˆå‰ç«¯ç·¨è¼¯åŠŸèƒ½å¯¦ä½œ  
- [ ] å»ºç«‹å°æ‡‰çš„ BDD æ¸¬è©¦å ´æ™¯
- [ ] å¯¦ä½œè¼¸å…¥é©—è­‰å’ŒéŒ¯èª¤è™•ç†æ©Ÿåˆ¶

**æœªä¾†æ”¹é€²é …ç›®ï¼ˆéé˜»å¡ï¼‰:**
- [ ] åŠ å…¥ç·¨è¼¯æ“ä½œçš„æ•ˆèƒ½ç›£æ§
- [ ] è€ƒæ…®åŠ å…¥ç·¨è¼¯æ­·å²è¨˜éŒ„åŠŸèƒ½
- [ ] å„ªåŒ–å¤§é‡ä»»å‹™æ™‚çš„ç·¨è¼¯æ•ˆèƒ½
- [ ] åŠ å…¥ç·¨è¼¯æ“ä½œçš„ç„¡éšœç¤™æ€§æ”¯æ´

### é–€æª»ç‹€æ…‹

Gate: FAIL â†’ docs/qa/gates/2.3-ç·¨è¼¯ä»»å‹™å…§å®¹åŠŸèƒ½.yml

**å¤±æ•—åŸå› ï¼š**
1. æ•…äº‹ç‹€æ…‹ä¸ç¬¦åˆå¯©æŸ¥æ¢ä»¶ï¼ˆDraft è€Œé Reviewï¼‰
2. ç¼ºå°‘å¿…è¦çš„ç¨‹å¼ç¢¼å¯¦ä½œ
3. ç„¡å°æ‡‰æ¸¬è©¦æª”æ¡ˆ
4. File List æœªæ›´æ–°

### å»ºè­°ç‹€æ…‹

âœ— è®Šæ›´å¿…éœ€ - éœ€è¦å®Œæˆå¯¦ä½œä¸¦æ›´æ–°æ•…äº‹ç‹€æ…‹è‡³ Review å¾Œé‡æ–°å¯©æŸ¥

**é–‹ç™¼è€…å¾ŒçºŒè¡Œå‹•ï¼š**
1. å®Œæˆæ‰€æœ‰ Tasks/Subtasks ä¸­çš„å¯¦ä½œé …ç›®
2. å»ºç«‹ä¸¦åŸ·è¡Œç›¸é—œæ¸¬è©¦
3. æ›´æ–° File List åŒ…å«æ‰€æœ‰ç•°å‹•æª”æ¡ˆ  
4. å°‡æ•…äº‹ç‹€æ…‹æ›´æ–°ç‚º Review
5. é‡æ–°è¦æ±‚ QA å¯©æŸ¥