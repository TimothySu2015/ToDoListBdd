Feature: 任務狀態切換
    作為生產力使用者
    我想要點擊任務勾選框來切換任務的完成/待辦狀態
    以便我可以追蹤工作進度並區分已完成和待辦的任務

Background:
    Given 我在任務清單頁面
    And 我有以下任務:
        | Description | IsCompleted |
        | 完成專案報告     | false       |
        | 測試功能       | false       |
        | 準備會議資料     | true        |

Scenario: 將待辦任務標記為已完成
    Given 我有一個待辦任務 "完成專案報告"
    When 我點擊任務的勾選框
    Then 任務應該顯示勾選標記
    And 任務文字應該顯示劃線效果
    And 應該播放完成動畫
    And 任務計數應該更新為 "1 個待辦任務, 2 個已完成"

Scenario: 將已完成任務重新標記為待辦
    Given 我有一個已完成任務 "準備會議資料"
    When 我點擊任務的勾選框
    Then 任務應該顯示空白勾選框
    And 任務文字劃線效果應該移除
    And 應該播放取消動畫
    And 任務計數應該更新為 "3 個待辦任務, 0 個已完成"

Scenario: 鍵盤操作切換任務狀態
    Given 我有一個待辦任務 "測試功能"
    And 任務項目獲得焦點
    When 我按下空白鍵
    Then 任務狀態應該切換為已完成
    And 應該顯示相應的視覺回饋
    And 任務計數應該即時更新

Scenario: 網路錯誤時狀態回滾
    Given 我有一個待辦任務 "測試功能"
    And API 服務無法回應
    When 我點擊任務的勾選框
    Then 任務應該暫時顯示為已完成
    And 2 秒後應該回滾到待辦狀態
    And 應該顯示錯誤訊息 "狀態更新失敗，請重試"

Scenario: 任務計數即時更新
    Given 我有 2 個待辦任務和 1 個已完成任務
    When 我將 1 個待辦任務標記為已完成
    Then 計數應該顯示 "1 個待辦任務, 2 個已完成"
    And 計數更新應該立即顯示

Scenario: 狀態切換動畫效果
    Given 我有一個待辦任務 "完成專案報告"
    When 我點擊任務的勾選框
    Then 應該播放 0.3 秒的完成動畫
    And 勾選框應該平滑地變為選中狀態
    And 文字應該平滑地顯示劃線效果